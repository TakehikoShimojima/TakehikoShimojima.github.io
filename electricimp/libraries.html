<!doctype html>
<html class="no-js" lang="">
<head>
<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Electric Imp">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>impプロジェクトをはじめましょう - Electric Imp</title>
<link rel="shortcut icon" href="/favicon.ico" />

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<style>
    body {
        /* padding-top: 20px;
        padding-bottom: 20px; */
    }
    .navbar {
        margin-bottom: 60px;
        height: 140px;
    }
    .navbar-brand img {
        padding: 20px 0;
    }
    .footer {
        margin-top: 60px;
        background: #F7F7F7;
    }
    .footer ul {
        padding-top: 35px;
        padding-left: 0px;
        margin-left: 0px;
    }
    .footer li {
        line-height: 25px;
        padding-left: 0px;
        margin-left: 0px;
        list-style: none;
    }
    .footer a {
        color: #999;
        font-weight: bold;
    }
    .footer #copyright {
        clear: left;
        margin-top: 35px;
        margin-bottom: 20px;
    }
    .alert-info {
        margin-top: 70px;
        background-image: none !important;
    }
</style>
</head>
<body>

<div class="navbar navbar-default">
    <div class="container">
        <div class="container-fluid">

            <div class="navbar-header">
                <a class="navbar-brand" href="https://www.switch-science.com/">
                    <img alt="switch-science" src="../top-logo.gif">
                </a>
            </div>

          </div>
    </div>
</div>

<div class="wrap">
    <div class="container">

        <div class="row">

            <div class="col-lg-8 col-sm-9 hidden-xs">
                <h3>Getting Started with the Electric Imp Platform（日本語）</h3>
                <h1>コードライブラリの実行準備</h1>
            </div>

            <div class="col-sm-9 col-lg-8">

        		<p>さて、個々の imp アプリケーションには2つのパート — <a href="agents.html">エージェントコード</a>と<a href="helloworld.html">デバイスコード</a> — があることを理解したので、自分のアプリケーション＝モデルを開発する準備ができました。ですが、必要とする全てのコードをどのように書き上げたらいいのかわからないと思うかもしれません。クラウドで動作し、Azure、AWS、PubNub、Twitterなどのサービスとアプリケーションを接続するソフトウェア。デバイスで動作し、LED、LCD、センサーやアクチュエーターなどのハードウェアに組み込みたい外部機器と通信するコード。これらはどのように書くのでしょうか。</p>

                <p>良いニュースは、これらのコードの多くはすでにあなたのために既に書かれているということです。より良いことに、これらの既存ソフトウェアをあなた自身のモデルに組み込むことは本当に簡単です。</p>

                <p>Electric Imp は、Webサービスからハードウェアのアドオンまで様々なものを表すオブジェクトのテンプレートとなる Squirrel クラスのライブラリを保持しています。これらのどれもが、単一の命令でコードに含めることができます。実は、これらのライブラリの1つである <a href="https://electricimp.com/docs/libraries/hardware/ws2812/">WS2812.class.nut</a> をすでに使っています。しかし、ライブラリはもっとたくさんあります。例えば、ライブラリを利用して impExplorer の基板上のセンサーを使うことができます。また結果を公開するため Twitter ライブラリを使うこともできます。</p>

                <h2 id="1.-power-up-the-impexplorer">1. impExplorer の電源を入れる</h2>

                <p>お持ちの impExplorer に電源を入れてインターネットに接続します。今回は USB ポートは使わず、単三電池3本（同梱されていません）を impExplorerの裏側に挿し込んでください。</p>

                <p>まだ設定がされていない場合は<a href="blinkup.html">このセクション</a>にやり方が記載されています。</p>

                <h2 id="2.-open-the-ide">2. IDE を開く</h2>

                <p>この Getting Started Guide の前のセクションを終えていれば、IDEがコンピュータ上で表示されているかと思います。もし開いていない場合は <a href="https://ide.electricimp.com/" target="_blank">ide.electricimp.com</a> に接続して、このガイドの<a href="account.html">最初のパート</a>で作成したアカウントを使ってサインインしてください。</p>

                <p><a href="ide.html">前のセクション</a>で作成した “Hello World” モデルを開いてください。‘Models’ タブを開き、マウスポインタを‘Actions’ 列にもっていきコードのアイコン (<img src="images/gsg_10_03.png" width="16">) をクリックします。IDEのコード編集画面がワークスペース上に表示されます。</p>

                <h2 id="3.-program-your-device-and-its-agent">3. デバイスとエージェントのプログラム</h2>

                <p>例を実行するために必要なコードは以下の通り— すでにモデルに追加ずみのコードと置き換えてください。今回も2つのパートがあります。1つはデバイスのコード、もう1つはエージェントのコードです。下記の2つのリストからコピーして、それぞれ IDE ワークスペースの適切な場所に貼り付けてください。もし IDE のどちらの部分にどちらを貼り付けていいかわからない場合は、<a href="ide.html">IDE のセクション</a>に戻り思い出してください。</p>

                <h3 id="device-code">デバイスコード</h3>

                <script src="https://gist.github.com/SwitchScienceCode/0a2f554dc6e49d72e03ddef9b7d834da.js?file=motiontweet.device.nut"></script>

                <h3 id="agent-code">エージェントコード</h3>
                
                <script src="https://gist.github.com/SwitchScienceCode/0a2f554dc6e49d72e03ddef9b7d834da.js?file=motiontweet.agent.nut"></script>

                <h3 id="what-the-code-does">このコードは何をしているのか</h3>

                <p>まずデバイスコードを見てみましょう。最初の3行は重要な行で <code>#require</code> ディレクティブを使って一連のライブラリを読み込んでいます。それぞれの行には、ダブルクオーテーションの間にライブラリ名と、 コロンで区切られたバージョン番号を見ることができます。このフォーマットは重要で、完全なライブラリ名と必要なバージョン番号の両方を含める必要があります。これらの2つの情報をコロンで区切り、それらをダブルクオーテーションで囲む必要があります。これはSquirrel コードではなくコンパイラに対する指示であるので、ディレクティブのあとにはセミコロンをつけないでください。</p>

                <p>その後、 <code>#require</code> 文の後ろにデバイスコードの本文が続きます、というより<strong>続かなければいけません</strong>。</p>

                <p>次に、定数と impExplorer のセンサーや RGB LED を参照するグローバル変数を宣言します。一連の測定値を取得し、LEDを点滅させてアクティビティを表示し、impExplorerをスリープ状態にしてAAバッテリを保持するときに呼び出される関数がその後に続きます。</p>

                <p>次にある関数は前述の点滅を実行する部分で、LED を青にセットし、0.5 秒間休止してから消灯します。</p>

                <p>最後のセクションでは、温度センサーと気圧センサーを表すソフトウェアオブジェクトをインスタンス化するため、Explore Kit の I2C バスを設定し使っています。 バスをローカル変数 <em>i2c</em> に割り当てていることに注意してください。グローバルではないすべての Squirrel 変数は、コンテクストに対して <code>local</code>  キーワードを使いローカル変数としてマークする必要があります。次に <a href="helloworld.html">Hello World</a> セクションでやったように LED を設定し、最後に測定値を読み取る関数を呼び出します。</p>

                <p>このプログラムは極めてリニアです。すべての設定を終え、測定値のセットを取得し、LED を点滅し、可能ならばimpOS にデバイスをスリープさせるよう指示します。 実際には、ここで関数を宣言する必要はありませんが、そうすることでプログラムをモジュール化し、関数として表されたコードの部分を 他のプログラムで使いやすくすることができます。</p>

                <p>なぜ毎回セットアップをするのでしょうか？ imp がスリープする時、エネルギーを節約するため低電力消費状態に入ります。これはバッテリで電源を供給している場合はとても有用です。これは多くのエネルギーを消費するタイミングが、impExplorer の電源を投入するときだけで済むことを意味します（30行目の <a href="https://electricimp.com/docs/api/server/sleepfor/"><strong>server.sleepfor()</strong></a> に渡される<em>sleepTime </em>定数で設定した2分ごとに、23行目にあるように測定値を取得し、それらを WiFi 接続で送信しています）。基板上の imp004m がスリープから復帰すると、Squirrel コードを新しい状態から開始します。そのためコンポーネントとバスを再度設定し直す必要があるのです。</p>

                <p>なぜ29行目の<a href="https://electricimp.com/docs/api/server/sleepfor/"> <strong>server.sleepfor()</strong> </a>を直接呼び出すだけではダメなのでしょうか？そうもできますが、imp API の<a href="https://electricimp.com/docs/api/imp/onidle/"> <strong>imp.onidle()</strong> </a>に関数を埋め込んで呼び出すことで、すべてをスリープさせる前に、impOS が必要とするハウスキーピングタスクを実行する時間を与えることができます。これは推奨されるアプローチです。<a href="https://electricimp.com/docs/api/imp/onidle/"><strong>imp.onidle()</strong></a> は、imp004m がアイドル状態になったときに呼び出される関数を登録します。ここでは関数の名前を渡さずに、インラインで関数宣言を使用しています。</p>

                <p>今、どのようにライブラリがコードに読み込まれるか理解したので、エージェントで何が起こっているかわかりますよね。今度もまた、プログラムの最初で Twitter ライブラリを読み込んでいます。忘れないでください。この行は最初に来なければいけません — コードの後ろの部分でライブラリを追加することは出来ず、その場合には無視されます。また <code>#require</code> 文にコードコンパイラが必要とするすべての情報、 完全なライブラリ名とバージョン番号が含まれていることを確認してください。</p>

                <p>エージェントは Twitter ライブラリを Twitter のアクセスクレデンシャル（後述）を設定するオブジェクトとなる <em>tweeter</em> を生成するのに使います。エージェントがデバイスが移動したことを示すメッセージ (<code>&#34;reading.sent&#34;</code>) をデバイスから受け取った時、呼び出される関数を登録します。この関数はデバイスから送られたデータを抽出し、Twitter クラスのインスタンスがつぶやくメッセージに挿入します。</p>

                <h2 id="4.-run-the-code">4. コードを実行する</h2>

                <p>このコードをあなた自身で試すためには、Twitter に行き、アプリ開発者として登録する必要があります。<a href="https://twitter.com/">Twitter のウェブサイト</a>に行き、ご自身の Twitter アカウントでサインインしてください。もし Twitter アカウントをお持ちでなければ、今すぐ取得する必要があります。サインインしたら <a href="https://apps.twitter.com/">アプリ管理のページ</a>に進んでください。ここで必要なことは、‘Create New App’ ボタンを押して Twitter がリクエストする情報を入力することです。</p>

                <p><img src="images/gsg_06_02.png" width="700"><br>&nbsp;</p>

                <p>この手続きは、Twitter フィードを自身のコードに埋め込むアプリ開発者を対象としています。まだ我々はアプリを開発していませんが、同じアプローチを使います。アプリをセットアップしたら ‘Keys and Access Tokens’ タブを探してください。ここに4つのコードがあります — Consumer Key (API Key), Consumer Key Secret (API Secret), Access Token and Access Token Secret — これらがエージェントコードにコピーが必要な値となります。</p>

                <p><img src="images/gsg_06_03.png" width="700"><br>&nbsp;</p>

                <p>これらの4つの値を1つずつ選択し、エージェントコードに貼り付けます（22∼25行目）。そして 'Build and Run'をクリックし、あなたの Twitter ストリームを見てみてください！</p>

                <h2 id="where-next?">次は?</h2>

                <p>我々が提供しているすべてのライブラリを見るには — リストは常に増えています —  <a href="https://electricimp.com/docs/libraries">ライブラリのページ</a>をご覧ください。コードにライブラリを含める方法、トラブルシューティングのガイダンス、あなたが書いたライブラリを Electric Imp Platform 経由でアクセスできるようにする方法など、より多くの情報も含まれています。</p>

                <p>Electric Imp の開発者として次に進むべき場所を知るには、<a href="nextsteps.html">次のセクション</a>をご覧ください。</p>

                <p><a href="nextsteps.html">次のセクション</a> に進むか <a href="index.html">最初のセクションに戻る</a></p>

            </div>

            <div class="col-lg-push-1 col-sm-3 col-lg-3 hidden-xs">
                <ul class="nav nav-pills nav-stacked">
                    <li class="open"><a href="index.html">Getting Started ガイド（日本語版）</a>
                        <ul class="nav nav-pills nav-stacked">
                            <li ><a href="account.html">Electric Imp アカウントの作成</a></li>
                            <li ><a href="blinkup.html">BlinkUp とインターネット接続設定</a></li>
                            <li ><a href="ide.html">Electric Imp IDE の紹介</a></li>
                            <li ><a href="helloworld.html">最初のプログラム: ‘Hello, World’</a></li>
                            <li ><a href="agents.html">エージェントと IoT アプリ</a></li>
                            <li class="active"><a href="libraries.html">コードライブラリの実行準備</a></li>  
                            <li ><a href="nextsteps.html">次のステップ</a></li>
                        </ul>
                    </li>
                </ul>
            </div>

        </div>

        <div class="alert alert-info" role="alert">
            <h5>免責条項:</h5>
            <p>
                <ul>
                    <li>スイッチサイエンス、ソフトバンクおよびElectric Impは、オリジナル文書からの翻訳によるいかなる問題についても責任を負いかねます。</li>
                    <li>Electric Impのテクノロジーとサービスは、<a href="https://electricimp.com/terms/" class="alert-link" target="_blank">https://electricimp.com/terms/</a> にあるElectric Imp利用規約に基づき利用されるものとします。</li>
                </ul>
            </p>
            <h5>本ページの内容について:</h5>
            <p>
                <ul>
                    <li>Electric Impのサイトにある<a href="https://electricimp.com/docs/gettingstarted/" class="alert-link">Getting Started with the Electric Imp Platform</a>を、Electric Imp社から許可を得て翻訳・掲載しています。</li>
                    <li>Electric Imp公式の翻訳文章ではありません。</li>
                    <li>imp004mモジュールに対応させる為、プログラムコードについては一部改変しています。</li>
                </ul>
            </p>
        </div>

    </div>

</div>

<div class="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-3">
                <ul>
                    <li></li>
                </ul>
            </div>
            <div class="col-xs-3">
                <ul>
                    <li></li>
                </ul>
            </div>
            <div class="col-xs-3">
                <ul>
                    <li></li>
                </ul>
            </div>
            <div class="col-xs-3">
                <ul>
                    <li></li>
                </ul>
            </div>
        </div>
        <div id="copyright">
            &copy; 2017 Switch Scinece, inc. &copy; 2017 SoftBank Corp. &copy; 2011-2017 Electric Imp, Inc.
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</body>
</html>

